{
  "variables": {
    "account_file": "{{env `GOOGLE_CREDENTIALS`}}",
    "project_id": "{{env `GOOGLE_PROJECT_ID`}}",
    "zone": "{{env `GOOGLE_DEFAULT_ZONE`}}",
    "tarmak_environment": "{{env `TARMAK_ENVIRONMENT`}}",
    "tarmak_base_image_name": "{{env `TARMAK_BASE_IMAGE_NAME`}}"
  },
  "builders": [
    {
      "type": "googlecompute",
      "account_file": "{{user `account_file`}}",
      "project_id": "{{user `project_id`}}",
      "ssh_username": "centos",
      "machine_type": "n1-standard-4",
      "source_image": "centos-7-v20170918",
      "zone": "{{user `zone`}}",
      "image_name": "{{user `tarmak_base_image_name`}}",
      "labels": {
        "name": "tarmak_{{user `tarmak_environment`}}_{{user `tarmak_base_image_name`}}",
        "tarmak_environment": "{{user `tarmak_environment`}}",
        "tarmak_base_image_name": "{{user `tarmak_base_image_name`}}"
      }
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "sudo -E -S sh '{{ .Path }}'",
      "inline": [
        "rm -f /etc/ssh/ssh_host_*",
        "rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm",
        "yum update -y",
        "yum install -y epel-release",
        "yum install -y git puppet-agent vim tmux socat python-pip at jq unzip",
        "pip install awscli"
      ]
    }
  ]
}